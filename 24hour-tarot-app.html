<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24ì‹œê°„ íƒ€ë¡œ ì•±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }

        :root {
            /* Figma ë””ìì¸ ìƒ‰ìƒ */
            --background: #0f0f1a;
            --foreground: #ffffff;
            --card: #1a1f3a;
            --card-foreground: #ffffff;
            --primary: #4a1a4f;
            --secondary: #1a1f3a;
            --secondary-foreground: #c8b8d4;
            --accent: #f4d03f;
            --accent-foreground: #0f0f1a;
            --border: #2a2f4a;
            --premium-gold: #f4d03f;
            --deep-purple: #4a1a4f;
            --midnight-blue: #1a1f3a;
            --muted: rgba(200, 184, 212, 0.5);
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--midnight-blue) 0%, var(--deep-purple) 50%, var(--midnight-blue) 100%);
            color: var(--foreground);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes mystical-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        @keyframes card-appear {
            0% { 
                opacity: 0; 
                transform: translateY(20px) scale(0.9) rotateY(180deg);
            }
            50% {
                opacity: 0.5;
                transform: translateY(10px) scale(0.95) rotateY(90deg);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1) rotateY(0deg);
            }
        }

        @keyframes card-flip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(180deg); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(244, 208, 63, 0.3); }
            50% { box-shadow: 0 0 40px rgba(244, 208, 63, 0.6); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes bounce-in {
            0% {
                opacity: 0;
                transform: scale(0.3) translate(-50%, -50%);
            }
            50% {
                opacity: 1;
                transform: scale(1.05) translate(-50%, -50%);
            }
            100% {
                opacity: 1;
                transform: scale(1) translate(-50%, -50%);
            }
        }

        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .mystical-pulse { animation: mystical-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .glow-effect { animation: glow 2s ease-in-out infinite; }
        .card-flip { animation: card-flip 0.6s ease-in-out; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì•± ì»¨í…Œì´ë„ˆ */
        .app-container {
            max-width: 375px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--background);
            position: relative;
            overflow: hidden;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            padding-bottom: 80px; /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ê³µê°„ */
            min-height: calc(100vh - 80px);
        }

        /* íƒ­ í™”ë©´ë“¤ */
        .tab-screen {
            display: none;
            padding: 20px;
            min-height: calc(100vh - 100px);
        }

        .tab-screen.active {
            display: block;
        }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 375px;
            height: 80px;
            background: rgba(26, 31, 58, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 8px 16px 24px;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 12px;
            min-width: 60px;
        }

        .nav-item.active {
            background: rgba(244, 208, 63, 0.1);
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-icon {
            color: var(--premium-gold);
            transform: scale(1.1);
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--secondary-foreground);
        }

        .nav-item.active .nav-label {
            color: var(--premium-gold);
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .screen-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .screen-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--premium-gold) 0%, #ffffff 50%, var(--premium-gold) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .screen-subtitle {
            color: var(--secondary-foreground);
            font-size: 16px;
        }

        .current-date {
            color: var(--muted);
            font-size: 14px;
            margin-top: 4px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--foreground);
            padding: 16px 24px;
            box-shadow: 0 4px 16px rgba(74, 26, 79, 0.3);
        }

        .btn-primary:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(74, 26, 79, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--secondary-foreground);
            border: 2px solid var(--border);
            padding: 14px 22px;
        }

        .btn-accent {
            background: var(--accent);
            color: var(--accent-foreground);
            padding: 16px 24px;
            box-shadow: 0 4px 16px rgba(244, 208, 63, 0.3);
        }

        .btn-large {
            font-size: 18px;
            padding: 20px 32px;
            border-radius: 16px;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--premium-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(244, 208, 63, 0.2);
        }

        /* íƒ€ë¡œ ì¹´ë“œ ì´ë¯¸ì§€ */
        .tarot-card {
            aspect-ratio: 2/3;
            background: linear-gradient(135deg, var(--card) 0%, var(--secondary) 100%);
            border: 2px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tarot-card.current-hour {
            border-color: var(--premium-gold);
            box-shadow: 0 0 20px rgba(244, 208, 63, 0.4);
        }

        .tarot-card.has-memo::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid var(--card);
        }

        .tarot-card.reversed {
            transform: rotate(180deg);
        }

        .tarot-card-back {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--deep-purple), var(--midnight-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--premium-gold);
        }

        .tarot-card-front {
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px;
            text-align: center;
        }

        .card-number {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--premium-gold);
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .card-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-top: auto;
        }

        .card-image {
            font-size: 32px;
            margin: 12px 0;
        }

        /* 24ì‹œê°„ ìŠ¤í¬ë¡¤ */
        .hour-scroll {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 16px 0;
            margin: 20px -20px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .hour-scroll::-webkit-scrollbar {
            display: none;
        }

        .hour-card {
            flex-shrink: 0;
            width: 80px;
            cursor: pointer;
            text-align: center;
        }

        .hour-card .tarot-card {
            width: 100%;
            height: 100px;
            margin-bottom: 8px;
        }

        .hour-time {
            font-size: 12px;
            font-weight: 600;
            color: var(--secondary-foreground);
        }

        .hour-card.current .hour-time {
            color: var(--premium-gold);
        }

        /* ë©”ì¸ ì¹´ë“œ ì˜ì—­ */
        .main-card-area {
            text-align: center;
            margin: 32px 0;
        }

        .main-card {
            width: 200px;
            height: 300px;
            margin: 0 auto 20px;
            position: relative;
        }

        .main-card-info {
            margin-top: 16px;
        }

        .main-card-time {
            font-size: 18px;
            font-weight: 600;
            color: var(--premium-gold);
            margin-bottom: 8px;
        }

        .main-card-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        /* ë©”ëª¨ ì˜ì—­ */
        .memo-area {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin: 24px 0;
        }

        .memo-textarea {
            width: 100%;
            min-height: 100px;
            background: transparent;
            border: none;
            color: var(--foreground);
            font-size: 14px;
            resize: vertical;
            outline: none;
        }

        .memo-textarea::placeholder {
            color: var(--muted);
        }

        .memo-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
        }

        .memo-save-btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* ìŠ¤í”„ë ˆë“œ ê·¸ë¦¬ë“œ */
        .spread-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 24px;
        }

        .spread-card {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .spread-card:hover {
            border-color: var(--premium-gold);
            transform: translateY(-2px);
        }

        .spread-preview {
            width: 40px;
            height: 60px;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .spread-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .spread-count {
            font-size: 12px;
            color: var(--muted);
        }

        /* ëª¨ë‹¬ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            max-width: 320px;
            width: 100%;
            position: relative;
            animation: bounce-in 0.5s ease-out;
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--muted);
            cursor: pointer;
            padding: 4px;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card);
            color: var(--foreground);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 14px;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 300px;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .toast.success {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
        }

        /* ë¡œë”© */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--premium-gold);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--foreground);
        }

        .empty-description {
            font-size: 14px;
            line-height: 1.4;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 320px) {
            .app-container {
                max-width: 100%;
            }
            
            .main-card {
                width: 160px;
                height: 240px;
            }
            
            .screen-title {
                font-size: 24px;
            }
            
            .hour-card {
                width: 70px;
            }
        }

        /* íŠ¹ë³„í•œ íš¨ê³¼ */
        .draw-cards-btn {
            position: relative;
            overflow: hidden;
        }

        .draw-cards-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .draw-cards-btn:hover::before {
            left: 100%;
        }

        /* ì¹´ë“œ ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .cards-generating {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 26, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            flex-direction: column;
        }

        .cards-generating.active {
            display: flex;
        }

        .generating-text {
            color: var(--premium-gold);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .generating-cards {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-width: 300px;
        }

        .generating-card {
            width: 30px;
            height: 45px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 4px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .generating-card.appear {
            opacity: 1;
            transform: scale(1);
            animation: card-appear 0.5s ease-out;
        }

        /* ìŠ¤í”„ë ˆë“œ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .spread-header {
            position: relative;
            display: flex;
            align-items: center;
            margin-bottom: 32px;
            padding: 20px 0;
        }

        .spread-canvas {
            min-height: 400px;
            background: var(--card);
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .spread-layout {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 350px;
        }

        .card-slot {
            position: absolute;
            width: 60px;
            height: 90px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(42, 47, 74, 0.3);
        }

        .card-slot:hover {
            border-color: var(--premium-gold);
            background: rgba(244, 208, 63, 0.1);
        }

        .card-slot.filled {
            border-style: solid;
            border-color: var(--premium-gold);
            background: transparent;
        }

        .card-slot .slot-label {
            font-size: 10px;
            color: var(--muted);
            text-align: center;
            padding: 4px;
            line-height: 1.2;
        }

        .card-slot .tarot-card {
            width: 100%;
            height: 100%;
            font-size: 20px;
            border: none;
        }

        .spread-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* ì¼ˆí‹± í¬ë¡œìŠ¤ ë ˆì´ì•„ì›ƒ */
        .celtic-cross {
            width: 300px;
            height: 300px;
            margin: 0 auto;
        }

        .celtic-cross .card-slot:nth-child(1) { /* í˜„ì¬ */
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .celtic-cross .card-slot:nth-child(2) { /* ë„ì „ */
            top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(90deg);
        }
        .celtic-cross .card-slot:nth-child(3) { /* ë¨¼ ê³¼ê±° */
            top: 50%; left: 20%; transform: translate(-50%, -50%);
        }
        .celtic-cross .card-slot:nth-child(4) { /* ê°€ëŠ¥í•œ ë¯¸ë˜ */
            top: 50%; right: 20%; transform: translate(50%, -50%);
        }
        .celtic-cross .card-slot:nth-child(5) { /* ìµœê·¼ ê³¼ê±° */
            bottom: 20%; left: 50%; transform: translate(-50%, 50%);
        }
        .celtic-cross .card-slot:nth-child(6) { /* ê°€ê¹Œìš´ ë¯¸ë˜ */
            top: 20%; left: 50%; transform: translate(-50%, -50%);
        }
        .celtic-cross .card-slot:nth-child(7) { /* ìì‹  */
            bottom: 10%; right: 10%;
        }
        .celtic-cross .card-slot:nth-child(8) { /* ì™¸ë¶€ ì˜í–¥ */
            bottom: 35%; right: 10%;
        }
        .celtic-cross .card-slot:nth-child(9) { /* í¬ë§ê³¼ ë‘ë ¤ì›€ */
            bottom: 60%; right: 10%;
        }
        .celtic-cross .card-slot:nth-child(10) { /* ìµœì¢… ê²°ê³¼ */
            top: 10%; right: 10%;
        }

        /* 3ì¹´ë“œ ìŠ¤í”„ë ˆë“œ ë ˆì´ì•„ì›ƒ */
        .three-card {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            padding: 40px 20px;
        }

        .three-card .card-slot {
            position: relative;
            flex-shrink: 0;
        }

        /* 5ì¹´ë“œ ìŠ¤í”„ë ˆë“œ ë ˆì´ì•„ì›ƒ */
        .five-card {
            width: 280px;
            height: 280px;
            margin: 0 auto;
        }

        .five-card .card-slot:nth-child(1) { /* ì¤‘ì•™ */
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .five-card .card-slot:nth-child(2) { /* ë™ìª½ */
            top: 50%; right: 10%; transform: translate(50%, -50%);
        }
        .five-card .card-slot:nth-child(3) { /* ë‚¨ìª½ */
            bottom: 10%; left: 50%; transform: translate(-50%, 50%);
        }
        .five-card .card-slot:nth-child(4) { /* ì„œìª½ */
            top: 50%; left: 10%; transform: translate(-50%, -50%);
        }
        .five-card .card-slot:nth-child(5) { /* ë¶ìª½ */
            top: 10%; left: 50%; transform: translate(-50%, -50%);
        }

        /* 1ì¹´ë“œ ìŠ¤í”„ë ˆë“œ ë ˆì´ì•„ì›ƒ */
        .one-card {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
        }

        .one-card .card-slot {
            position: relative;
            width: 100px;
            height: 150px;
        }

        /* ì¹´ë“œ ë½‘ê¸° ëª¨ë‹¬ */
        .draw-card-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .draw-card-modal.active {
            display: flex;
        }

        .drawing-card {
            width: 120px;
            height: 180px;
            margin: 0 auto;
            position: relative;
        }

        .drawing-card .tarot-card {
            width: 100%;
            height: 100%;
            animation: card-flip 0.8s ease-in-out;
        }

        /* ì¼ê¸° íƒ­ ìŠ¤íƒ€ì¼ */
        .segment-control {
            display: flex;
            background: var(--card);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .segment-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--secondary-foreground);
        }

        .segment-btn.active {
            background: var(--primary);
            color: var(--foreground);
            box-shadow: 0 2px 8px rgba(74, 26, 79, 0.3);
        }

        .diary-section {
            min-height: 400px;
        }

        /* ë°ì¼ë¦¬ ì¹´ë“œ ìŠ¤í¬ë¡¤ */
        .daily-cards-scroll {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .daily-card-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .daily-card-item:hover {
            border-color: var(--premium-gold);
            transform: translateY(-2px);
        }

        .daily-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .daily-card-date {
            font-size: 16px;
            font-weight: 600;
            color: var(--premium-gold);
        }

        .daily-card-memo-count {
            font-size: 12px;
            color: var(--muted);
        }

        .daily-card-preview {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .daily-card-preview::-webkit-scrollbar {
            display: none;
        }

        .daily-preview-card {
            flex-shrink: 0;
            width: 40px;
            height: 60px;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* ì €ì¥ëœ ìŠ¤í”„ë ˆë“œ ê·¸ë¦¬ë“œ */
        .saved-spreads-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .saved-spread-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .saved-spread-item:hover {
            border-color: var(--premium-gold);
            transform: translateY(-2px);
        }

        .saved-spread-thumbnail {
            width: 80px;
            height: 120px;
            background: var(--secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            overflow: hidden;
        }

        .spread-mini-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            width: 100%;
            height: 100%;
            padding: 4px;
        }

        .spread-mini-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 2px;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .saved-spread-info {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .saved-spread-meta {
            font-size: 12px;
            color: var(--muted);
        }

        /* ë¹ˆ ìƒíƒœ ê°œì„  */
        .diary-empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--muted);
        }

        .diary-empty-state .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .diary-empty-state .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--foreground);
        }

        .diary-empty-state .empty-description {
            font-size: 14px;
            line-height: 1.5;
            max-width: 280px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- íƒ€ì´ë¨¸ íƒ­ -->
            <div id="timer-tab" class="tab-screen active">
                <div class="screen-header">
                    <h1 class="screen-title mystical-pulse">ì˜¤ëŠ˜ì˜ 24ì‹œê°„ íƒ€ë¡œ</h1>
                    <div class="current-date" id="current-date"></div>
                </div>

                <!-- ì¹´ë“œ ë½‘ê¸° ë²„íŠ¼ (ì²« ì§„ì… ì‹œë§Œ í‘œì‹œ) -->
                <div id="draw-cards-section" class="text-center" style="margin: 40px 0;">
                    <button id="draw-cards-btn" class="btn btn-accent btn-large draw-cards-btn">
                        âœ¨ ì˜¤ëŠ˜ì˜ 24ì‹œê°„ íƒ€ë¡œ ë½‘ê¸°
                    </button>
                </div>

                <!-- ë©”ì¸ ì¹´ë“œ ì˜ì—­ -->
                <div id="main-card-section" class="main-card-area" style="display: none;">
                    <div class="main-card">
                        <div id="main-tarot-card" class="tarot-card glow-effect">
                            <div class="tarot-card-back">ğŸ”®</div>
                        </div>
                    </div>
                    <div class="main-card-info">
                        <div id="main-card-time" class="main-card-time">í˜„ì¬ ì˜¤í›„ 3ì‹œ ì¹´ë“œ</div>
                        <div id="main-card-name" class="main-card-name">The Sun</div>
                    </div>
                </div>

                <!-- ë©”ëª¨ ì˜ì—­ -->
                <div id="memo-section" class="memo-area" style="display: none;">
                    <textarea 
                        id="current-memo" 
                        class="memo-textarea" 
                        placeholder="ì´ ì‹œê°„ì— ì¼ì–´ë‚œ ì¼ì„ ê¸°ë¡í•´ë³´ì„¸ìš”â€¦"></textarea>
                    <div class="memo-actions">
                        <div style="color: var(--muted); font-size: 12px;">ìë™ ì €ì¥ë¨</div>
                        <button id="save-memo-btn" class="btn btn-primary memo-save-btn">ì €ì¥</button>
                    </div>
                </div>

                <!-- 24ì‹œê°„ ìŠ¤í¬ë¡¤ -->
                <div id="hour-scroll-section" class="hour-scroll" style="display: none;">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>

            <!-- ìŠ¤í”„ë ˆë“œ íƒ­ -->
            <div id="spread-tab" class="tab-screen">
                <!-- ìŠ¤í”„ë ˆë“œ ì„ íƒ í™”ë©´ -->
                <div id="spread-selection-screen">
                    <div class="screen-header">
                        <h1 class="screen-title">íƒ€ë¡œ ìŠ¤í”„ë ˆë“œ</h1>
                        <p class="screen-subtitle">ì›í•˜ëŠ” ìŠ¤í”„ë ˆë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                    </div>

                    <div class="spread-grid">
                        <div class="spread-card" data-spread="celtic-cross" data-count="10">
                            <div class="spread-preview">âšœï¸</div>
                            <div class="spread-name">ì¼ˆí‹± í¬ë¡œìŠ¤</div>
                            <div class="spread-count">10ì¥ + ì‹œê°„ì„  4ì¥</div>
                        </div>
                        <div class="spread-card" data-spread="cup-relationship" data-count="7">
                            <div class="spread-preview">ğŸ’•</div>
                            <div class="spread-name">ì»µ ì˜¤ë¸Œ ë¦´ë ˆì´ì…˜ì‹­</div>
                            <div class="spread-count">7ì¥</div>
                        </div>
                        <div class="spread-card" data-spread="five-card" data-count="5">
                            <div class="spread-preview">ğŸŒŸ</div>
                            <div class="spread-name">5ì¹´ë“œ ìŠ¤í”„ë ˆë“œ</div>
                            <div class="spread-count">5ì¥</div>
                        </div>
                        <div class="spread-card" data-spread="four-timeline" data-count="4">
                            <div class="spread-preview">â°</div>
                            <div class="spread-name">4ì¹´ë“œ ì‹œê°„ì„ </div>
                            <div class="spread-count">4ì¥</div>
                        </div>
                        <div class="spread-card" data-spread="three-card" data-count="3">
                            <div class="spread-preview">ğŸ”®</div>
                            <div class="spread-name">3ì¹´ë“œ ìŠ¤í”„ë ˆë“œ</div>
                            <div class="spread-count">3ì¥</div>
                        </div>
                        <div class="spread-card" data-spread="one-card" data-count="1">
                            <div class="spread-preview">âœ¨</div>
                            <div class="spread-name">1ì¹´ë“œ ìŠ¤í”„ë ˆë“œ</div>
                            <div class="spread-count">1ì¥</div>
                        </div>
                    </div>
                </div>

                <!-- í™œì„± ìŠ¤í”„ë ˆë“œ í™”ë©´ -->
                <div id="active-spread-screen" style="display: none;">
                    <div class="spread-header">
                        <button id="back-to-spreads" class="btn btn-secondary" style="position: absolute; left: 0; top: 0; padding: 8px 12px; font-size: 14px;">â† ë’¤ë¡œ</button>
                        <div style="text-align: center; flex: 1;">
                            <h2 id="current-spread-name" class="screen-title" style="font-size: 20px; margin-bottom: 4px;"></h2>
                            <div id="spread-progress" class="screen-subtitle"></div>
                        </div>
                    </div>

                    <!-- ìŠ¤í”„ë ˆë“œ ìº”ë²„ìŠ¤ -->
                    <div id="spread-canvas" class="spread-canvas">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>

                    <!-- ìŠ¤í”„ë ˆë“œ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                    <div class="spread-actions">
                        <button id="capture-spread" class="btn btn-accent" style="flex: 1; margin-right: 8px;" disabled>
                            ğŸ“¸ ìº¡ì²˜ ì €ì¥
                        </button>
                        <button id="reset-spread" class="btn btn-secondary" onclick="resetCurrentSpread()">
                            ğŸ”„ ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì¼ê¸° íƒ­ -->
            <div id="diary-tab" class="tab-screen">
                <div class="screen-header">
                    <h1 class="screen-title">íƒ€ë¡œ ì¼ê¸°</h1>
                </div>

                <!-- ì„¸ê·¸ë¨¼íŠ¸ ì»¨íŠ¸ë¡¤ -->
                <div class="segment-control">
                    <button id="daily-segment" class="segment-btn active">ë°ì¼ë¦¬ íƒ€ë¡œ</button>
                    <button id="spreads-segment" class="segment-btn">ì €ì¥ëœ ìŠ¤í”„ë ˆë“œ</button>
                </div>

                <!-- ë°ì¼ë¦¬ íƒ€ë¡œ ì„¹ì…˜ -->
                <div id="daily-section" class="diary-section">
                    <div id="daily-cards-scroll" class="daily-cards-scroll">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- ì €ì¥ëœ ìŠ¤í”„ë ˆë“œ ì„¹ì…˜ -->
                <div id="spreads-section" class="diary-section" style="display: none;">
                    <div id="saved-spreads-grid" class="saved-spreads-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
            </div>

            <!-- ì„¤ì • íƒ­ -->
            <div id="settings-tab" class="tab-screen">
                <div class="screen-header">
                    <h1 class="screen-title">ì„¤ì •</h1>
                </div>

                <div class="card" style="padding: 20px; margin-bottom: 16px;">
                    <h3 style="color: var(--premium-gold); margin-bottom: 16px;">í…Œë§ˆ ë± ê´€ë¦¬</h3>
                    <div style="margin-bottom: 12px;">í˜„ì¬ í…Œë§ˆ: í´ë˜ì‹ íƒ€ë¡œ</div>
                    <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                        <div class="tarot-card" style="width: 50px; height: 75px; font-size: 16px;">ğŸ”®</div>
                        <div class="tarot-card" style="width: 50px; height: 75px; font-size: 16px;">â­</div>
                        <div class="tarot-card" style="width: 50px; height: 75px; font-size: 16px;">ğŸŒ™</div>
                        <div class="tarot-card" style="width: 50px; height: 75px; font-size: 16px;">â˜€ï¸</div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;">í…Œë§ˆ ë± ìƒì </button>
                </div>

                <div class="card" style="padding: 20px; margin-bottom: 16px;">
                    <h3 style="color: var(--premium-gold); margin-bottom: 16px;">ì•Œë¦¼ ì„¤ì •</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                        <span>ì‹œê°„ë³„ ì•Œë¦¼</span>
                        <span style="color: var(--success);">ì¼œì§</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                        <span>ìì • ë¦¬ì…‹ ì•Œë¦¼</span>
                        <span style="color: var(--success);">ì¼œì§</span>
                    </div>
                </div>

                <div class="card" style="padding: 20px;">
                    <h3 style="color: var(--premium-gold); margin-bottom: 16px;">ì•± ì •ë³´</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                        <span>ë²„ì „</span>
                        <span style="color: var(--muted);">1.0.0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                        <span>ì œì‘ì</span>
                        <span style="color: var(--muted);">Claude Code</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bottom-navigation">
            <div class="nav-item active" data-tab="timer">
                <div class="nav-icon">â°</div>
                <div class="nav-label">íƒ€ì´ë¨¸</div>
            </div>
            <div class="nav-item" data-tab="spread">
                <div class="nav-icon">ğŸ”®</div>
                <div class="nav-label">ìŠ¤í”„ë ˆë“œ</div>
            </div>
            <div class="nav-item" data-tab="diary">
                <div class="nav-icon">ğŸ“–</div>
                <div class="nav-label">ì¼ê¸°</div>
            </div>
            <div class="nav-item" data-tab="settings">
                <div class="nav-icon">âš™ï¸</div>
                <div class="nav-label">ì„¤ì •</div>
            </div>
        </div>

        <!-- ì¹´ë“œ ìƒì„± ì• ë‹ˆë©”ì´ì…˜ -->
        <div id="cards-generating" class="cards-generating">
            <div class="generating-text">âœ¨ 24ì‹œê°„ íƒ€ë¡œ ì¹´ë“œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
            <div class="generating-cards">
                <!-- 24ê°œ ì¹´ë“œê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>

        <!-- ì¹´ë“œ ìƒì„¸ ëª¨ë‹¬ -->
        <div id="card-detail-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-card-time" class="modal-title">ì˜¤í›„ 3ì‹œ</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="modal-tarot-card" class="tarot-card" style="width: 120px; height: 180px; margin: 0 auto 16px;">
                        <div class="tarot-card-back">ğŸ”®</div>
                    </div>
                    <div id="modal-card-name" style="text-align: center; font-weight: 600; margin-bottom: 16px;">The Sun</div>
                    <textarea id="modal-memo" class="memo-textarea" placeholder="ì´ ì‹œê°„ì— ì¼ì–´ë‚œ ì¼ì„ ê¸°ë¡í•´ë³´ì„¸ìš”â€¦"></textarea>
                    <div style="display: flex; justify-content: space-between; margin-top: 16px;">
                        <button id="prev-hour-btn" class="btn btn-secondary">â† ì´ì „</button>
                        <button id="next-hour-btn" class="btn btn-secondary">ë‹¤ìŒ â†’</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¹´ë“œ ë½‘ê¸° ëª¨ë‹¬ -->
        <div id="draw-card-modal" class="draw-card-modal">
            <div class="drawing-card">
                <div id="drawing-tarot-card" class="tarot-card">
                    <div class="tarot-card-back">ğŸ”®</div>
                </div>
                <div style="text-align: center; color: var(--premium-gold); margin-top: 16px; font-size: 14px;">
                    ì¹´ë“œë¥¼ ë½‘ê³  ìˆìŠµë‹ˆë‹¤...
                </div>
            </div>
        </div>

        <!-- í† ìŠ¤íŠ¸ -->
        <div id="toast" class="toast"></div>
    </div>

    <script>
        // ì „ì—­ ìƒíƒœ
        let currentHour = new Date().getHours();
        let todayCards = {};
        let memos = {};
        let isCardsDrawn = false;
        
        // ìŠ¤í”„ë ˆë“œ ìƒíƒœ
        let currentSpread = null;
        let currentSpreadCards = {};
        let spreadProgress = 0;
        
        // íƒ€ë¡œ ì¹´ë“œ ë°ì´í„° (78ì¥ì˜ íƒ€ë¡œ ì¹´ë“œ)
        const tarotCards = [
            { name: "The Fool", emoji: "ğŸƒ", number: "0" },
            { name: "The Magician", emoji: "ğŸ©", number: "I" },
            { name: "The High Priestess", emoji: "ğŸŒ™", number: "II" },
            { name: "The Empress", emoji: "ğŸ‘‘", number: "III" },
            { name: "The Emperor", emoji: "ğŸ›ï¸", number: "IV" },
            { name: "The Hierophant", emoji: "â›ª", number: "V" },
            { name: "The Lovers", emoji: "ğŸ’•", number: "VI" },
            { name: "The Chariot", emoji: "ğŸ‡", number: "VII" },
            { name: "Strength", emoji: "ğŸ¦", number: "VIII" },
            { name: "The Hermit", emoji: "ğŸ®", number: "IX" },
            { name: "Wheel of Fortune", emoji: "ğŸ¡", number: "X" },
            { name: "Justice", emoji: "âš–ï¸", number: "XI" },
            { name: "The Hanged Man", emoji: "ğŸ™ƒ", number: "XII" },
            { name: "Death", emoji: "ğŸ’€", number: "XIII" },
            { name: "Temperance", emoji: "ğŸ·", number: "XIV" },
            { name: "The Devil", emoji: "ğŸ‘¹", number: "XV" },
            { name: "The Tower", emoji: "ğŸ—¼", number: "XVI" },
            { name: "The Star", emoji: "â­", number: "XVII" },
            { name: "The Moon", emoji: "ğŸŒ™", number: "XVIII" },
            { name: "The Sun", emoji: "â˜€ï¸", number: "XIX" },
            { name: "Judgement", emoji: "ğŸ“¯", number: "XX" },
            { name: "The World", emoji: "ğŸŒ", number: "XXI" },
            // ì»µ ìŠˆíŠ¸
            { name: "Ace of Cups", emoji: "ğŸ†", number: "Aâ™¥" },
            { name: "Two of Cups", emoji: "ğŸ’‘", number: "2â™¥" },
            { name: "Three of Cups", emoji: "ğŸ¥‚", number: "3â™¥" },
            { name: "Four of Cups", emoji: "ğŸµ", number: "4â™¥" },
            { name: "Five of Cups", emoji: "ğŸ˜¢", number: "5â™¥" },
            { name: "Six of Cups", emoji: "ğŸ", number: "6â™¥" },
            { name: "Seven of Cups", emoji: "ğŸ’­", number: "7â™¥" },
            { name: "Eight of Cups", emoji: "ğŸš¶", number: "8â™¥" },
            { name: "Nine of Cups", emoji: "ğŸ˜Š", number: "9â™¥" },
            { name: "Ten of Cups", emoji: "ğŸ ", number: "10â™¥" },
            { name: "Page of Cups", emoji: "ğŸ§’", number: "Jâ™¥" },
            { name: "Knight of Cups", emoji: "ğŸ‡", number: "Knâ™¥" },
            { name: "Queen of Cups", emoji: "ğŸ‘¸", number: "Qâ™¥" },
            { name: "King of Cups", emoji: "ğŸ‘‘", number: "Kâ™¥" },
            // íœíƒ€í´ ìŠˆíŠ¸
            { name: "Ace of Pentacles", emoji: "ğŸ’°", number: "Aâ™¦" },
            { name: "Two of Pentacles", emoji: "âš–ï¸", number: "2â™¦" },
            { name: "Three of Pentacles", emoji: "ğŸ—ï¸", number: "3â™¦" },
            { name: "Four of Pentacles", emoji: "ğŸ”’", number: "4â™¦" },
            { name: "Five of Pentacles", emoji: "â„ï¸", number: "5â™¦" },
            { name: "Six of Pentacles", emoji: "ğŸ¤", number: "6â™¦" },
            { name: "Seven of Pentacles", emoji: "ğŸŒ±", number: "7â™¦" },
            { name: "Eight of Pentacles", emoji: "ğŸ”¨", number: "8â™¦" },
            { name: "Nine of Pentacles", emoji: "ğŸ‡", number: "9â™¦" },
            { name: "Ten of Pentacles", emoji: "ğŸ°", number: "10â™¦" },
            { name: "Page of Pentacles", emoji: "ğŸ“š", number: "Jâ™¦" },
            { name: "Knight of Pentacles", emoji: "ğŸ", number: "Knâ™¦" },
            { name: "Queen of Pentacles", emoji: "ğŸŒº", number: "Qâ™¦" },
            { name: "King of Pentacles", emoji: "ğŸ‘‘", number: "Kâ™¦" },
            // ì†Œë“œ ìŠˆíŠ¸
            { name: "Ace of Swords", emoji: "âš”ï¸", number: "Aâ™ " },
            { name: "Two of Swords", emoji: "ğŸ¤·", number: "2â™ " },
            { name: "Three of Swords", emoji: "ğŸ’”", number: "3â™ " },
            { name: "Four of Swords", emoji: "ğŸ˜´", number: "4â™ " },
            { name: "Five of Swords", emoji: "ğŸ˜¤", number: "5â™ " },
            { name: "Six of Swords", emoji: "â›µ", number: "6â™ " },
            { name: "Seven of Swords", emoji: "ğŸ¥·", number: "7â™ " },
            { name: "Eight of Swords", emoji: "ğŸª¢", number: "8â™ " },
            { name: "Nine of Swords", emoji: "ğŸ˜°", number: "9â™ " },
            { name: "Ten of Swords", emoji: "âš°ï¸", number: "10â™ " },
            { name: "Page of Swords", emoji: "ğŸ—¡ï¸", number: "Jâ™ " },
            { name: "Knight of Swords", emoji: "ğŸƒ", number: "Knâ™ " },
            { name: "Queen of Swords", emoji: "â„ï¸", number: "Qâ™ " },
            { name: "King of Swords", emoji: "âš”ï¸", number: "Kâ™ " },
            // ì™„ë“œ ìŠˆíŠ¸
            { name: "Ace of Wands", emoji: "ğŸŒ¿", number: "Aâ™£" },
            { name: "Two of Wands", emoji: "ğŸ—ºï¸", number: "2â™£" },
            { name: "Three of Wands", emoji: "ğŸš¢", number: "3â™£" },
            { name: "Four of Wands", emoji: "ğŸ‰", number: "4â™£" },
            { name: "Five of Wands", emoji: "ğŸ¤¼", number: "5â™£" },
            { name: "Six of Wands", emoji: "ğŸ†", number: "6â™£" },
            { name: "Seven of Wands", emoji: "ğŸ›¡ï¸", number: "7â™£" },
            { name: "Eight of Wands", emoji: "ğŸ¹", number: "8â™£" },
            { name: "Nine of Wands", emoji: "ğŸ¤•", number: "9â™£" },
            { name: "Ten of Wands", emoji: "ğŸ“¦", number: "10â™£" },
            { name: "Page of Wands", emoji: "ğŸ”¥", number: "Jâ™£" },
            { name: "Knight of Wands", emoji: "ğŸ‡", number: "Knâ™£" },
            { name: "Queen of Wands", emoji: "ğŸ¦", number: "Qâ™£" },
            { name: "King of Wands", emoji: "ğŸ”¥", number: "Kâ™£" }
        ];

        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            updateCurrentDate();
            loadUserData();
            setupEventListeners();
            updateCurrentTime();
            
            // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(updateCurrentTime, 1000);
            
            // 5ë¶„ë§ˆë‹¤ ì €ì¥
            setInterval(saveUserData, 5 * 60 * 1000);
        }

        function setupEventListeners() {
            // ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ì´ë²¤íŠ¸
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => switchTab(item));
            });

            // ì¹´ë“œ ë½‘ê¸° ë²„íŠ¼
            document.getElementById('draw-cards-btn').addEventListener('click', drawDailyCards);

            // ë©”ëª¨ ì €ì¥
            document.getElementById('save-memo-btn').addEventListener('click', saveMemo);
            
            // ë©”ëª¨ ìë™ ì €ì¥
            document.getElementById('current-memo').addEventListener('input', debounce(autoSaveMemo, 1000));

            // ëª¨ë‹¬ ë‹«ê¸°
            document.querySelector('.modal-close').addEventListener('click', closeModal);
            document.getElementById('card-detail-modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            // ëª¨ë‹¬ ë„¤ë¹„ê²Œì´ì…˜
            document.getElementById('prev-hour-btn').addEventListener('click', () => navigateHour(-1));
            document.getElementById('next-hour-btn').addEventListener('click', () => navigateHour(1));

            // ìŠ¤í”„ë ˆë“œ ê´€ë ¨ ì´ë²¤íŠ¸
            document.querySelectorAll('.spread-card').forEach(card => {
                card.addEventListener('click', () => selectSpread(card));
            });

            // ìŠ¤í”„ë ˆë“œ ë’¤ë¡œê°€ê¸°
            document.getElementById('back-to-spreads').addEventListener('click', backToSpreadSelection);

            // ìŠ¤í”„ë ˆë“œ ì•¡ì…˜ ë²„íŠ¼ë“¤
            document.getElementById('capture-spread').addEventListener('click', captureSpread);
            document.getElementById('reset-spread').addEventListener('click', resetCurrentSpread);

            // ì¼ê¸° íƒ­ ì„¸ê·¸ë¨¼íŠ¸ ì»¨íŠ¸ë¡¤
            document.getElementById('daily-segment').addEventListener('click', () => switchDiarySection('daily'));
            document.getElementById('spreads-segment').addEventListener('click', () => switchDiarySection('spreads'));
        }

        function switchTab(clickedItem) {
            // ëª¨ë“  íƒ­ê³¼ í™”ë©´ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.tab-screen').forEach(screen => screen.classList.remove('active'));

            // í´ë¦­ëœ íƒ­ê³¼ í•´ë‹¹ í™”ë©´ í™œì„±í™”
            clickedItem.classList.add('active');
            const tabName = clickedItem.dataset.tab;
            document.getElementById(tabName + '-tab').classList.add('active');

            // ì¼ê¸° íƒ­ ì§„ì… ì‹œ ë°ì´í„° ë¡œë“œ
            if (tabName === 'diary') {
                loadDiaryData();
            }
        }

        // ì¼ê¸° íƒ­ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function switchDiarySection(section) {
            // ì„¸ê·¸ë¨¼íŠ¸ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.segment-btn').forEach(btn => btn.classList.remove('active'));
            
            if (section === 'daily') {
                document.getElementById('daily-segment').classList.add('active');
                document.getElementById('daily-section').style.display = 'block';
                document.getElementById('spreads-section').style.display = 'none';
                loadDailyCards();
            } else {
                document.getElementById('spreads-segment').classList.add('active');
                document.getElementById('daily-section').style.display = 'none';
                document.getElementById('spreads-section').style.display = 'block';
                loadSavedSpreads();
            }
        }

        function loadDiaryData() {
            // ê¸°ë³¸ì ìœ¼ë¡œ ë°ì¼ë¦¬ íƒ€ë¡œ ì„¹ì…˜ í‘œì‹œ
            switchDiarySection('daily');
        }

        function loadDailyCards() {
            const container = document.getElementById('daily-cards-scroll');
            const dailyData = getDailyCardsData();
            
            if (dailyData.length === 0) {
                container.innerHTML = `
                    <div class="diary-empty-state">
                        <div class="empty-icon">ğŸŒŸ</div>
                        <div class="empty-title">ì•„ì§ ë°ì¼ë¦¬ íƒ€ë¡œê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-description">íƒ€ì´ë¨¸ íƒ­ì—ì„œ 24ì‹œê°„ íƒ€ë¡œë¥¼ ë½‘ê³ <br>ë©”ëª¨ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            dailyData.forEach(dayData => {
                const memoCount = dayData.memoCount;
                const dateStr = formatDiaryDate(dayData.date);
                
                html += `
                    <div class="daily-card-item" onclick="openDailyDetail('${dayData.date}')">
                        <div class="daily-card-header">
                            <div class="daily-card-date">${dateStr}</div>
                            <div class="daily-card-memo-count">ë©”ëª¨ ${memoCount}ê°œ</div>
                        </div>
                        <div class="daily-card-preview">
                            ${dayData.previewCards.map(card => `
                                <div class="daily-preview-card">${card.emoji}</div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadSavedSpreads() {
            const container = document.getElementById('saved-spreads-grid');
            
            try {
                const savedSpreads = JSON.parse(localStorage.getItem('saved-spreads') || '[]');
                
                if (savedSpreads.length === 0) {
                    container.innerHTML = `
                        <div class="diary-empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-icon">ğŸ”®</div>
                            <div class="empty-title">ì €ì¥ëœ ìŠ¤í”„ë ˆë“œê°€ ì—†ìŠµë‹ˆë‹¤</div>
                            <div class="empty-description">ìŠ¤í”„ë ˆë“œ íƒ­ì—ì„œ ì¹´ë“œë¥¼ ë½‘ê³ <br>ì™„ì„±ëœ ìŠ¤í”„ë ˆë“œë¥¼ ì €ì¥í•´ë³´ì„¸ìš”</div>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                savedSpreads.forEach(spread => {
                    const date = new Date(spread.createdAt);
                    const dateStr = date.toLocaleDateString('ko-KR', { 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    
                    // ë¯¸ë‹ˆ ì¹´ë“œë“¤ ìƒì„±
                    const miniCards = Object.values(spread.cards).slice(0, 9); // ìµœëŒ€ 9ê°œ
                    const miniCardsHtml = miniCards.map(card => 
                        `<div class="spread-mini-card">${card.emoji}</div>`
                    ).join('');
                    
                    html += `
                        <div class="saved-spread-item" onclick="openSpreadDetail(${spread.id})">
                            <div class="saved-spread-thumbnail">
                                <div class="spread-mini-cards">
                                    ${miniCardsHtml}
                                </div>
                            </div>
                            <div class="saved-spread-info">${spread.name}</div>
                            <div class="saved-spread-meta">${dateStr} â€¢ ${spread.type}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error('ì €ì¥ëœ ìŠ¤í”„ë ˆë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
                container.innerHTML = `
                    <div class="diary-empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">âŒ</div>
                        <div class="empty-title">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>
                        <div class="empty-description">ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
                    </div>
                `;
            }
        }

        function getDailyCardsData() {
            const data = [];
            
            // todayCardsì—ì„œ ë°ì´í„° ì¶”ì¶œ
            Object.keys(todayCards).forEach(dateStr => {
                const dayCards = todayCards[dateStr];
                if (!dayCards) return;
                
                // ë©”ëª¨ ê°œìˆ˜ ê³„ì‚°
                let memoCount = 0;
                for (let hour = 0; hour < 24; hour++) {
                    const memoKey = `${dateStr}-${hour}`;
                    if (memos[memoKey]?.trim()) {
                        memoCount++;
                    }
                }
                
                // ë¯¸ë¦¬ë³´ê¸° ì¹´ë“œë“¤ (ì²« 4ì¥)
                const previewCards = [];
                for (let hour = 0; hour < Math.min(4, 24); hour++) {
                    if (dayCards[hour]) {
                        previewCards.push(dayCards[hour]);
                    }
                }
                
                if (previewCards.length > 0) {
                    data.push({
                        date: dateStr,
                        memoCount,
                        previewCards
                    });
                }
            });
            
            // ìµœì‹ ìˆœ ì •ë ¬
            return data.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        function formatDiaryDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            
            if (date.toDateString() === today.toDateString()) {
                return 'ì˜¤ëŠ˜';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'ì–´ì œ';
            } else {
                return date.toLocaleDateString('ko-KR', {
                    month: 'long',
                    day: 'numeric',
                    weekday: 'short'
                });
            }
        }

        function openDailyDetail(dateStr) {
            // ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ)
            showToast('ğŸ“– ë°ì¼ë¦¬ ìƒì„¸ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤');
        }

        function openSpreadDetail(spreadId) {
            // ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ)
            showToast('ğŸ”® ìŠ¤í”„ë ˆë“œ ìƒì„¸ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤');
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                weekday: 'short' 
            };
            const dateString = now.toLocaleDateString('ko-KR', options);
            document.getElementById('current-date').textContent = dateString;
        }

        function updateCurrentTime() {
            const now = new Date();
            currentHour = now.getHours();
            
            if (isCardsDrawn) {
                updateMainCard();
                updateHourHighlight();
            }
        }

        function drawDailyCards() {
            const drawBtn = document.getElementById('draw-cards-btn');
            const generateScreen = document.getElementById('cards-generating');
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            drawBtn.disabled = true;
            drawBtn.innerHTML = '<div class="loading"></div> ìƒì„± ì¤‘...';
            
            // ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ í‘œì‹œ
            setTimeout(() => {
                generateScreen.classList.add('active');
                startCardGenerationAnimation();
            }, 500);
        }

        function startCardGenerationAnimation() {
            const cardsContainer = document.querySelector('.generating-cards');
            cardsContainer.innerHTML = '';
            
            // 24ê°œ ì¹´ë“œ ìƒì„±
            for (let i = 0; i < 24; i++) {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'generating-card';
                cardsContainer.appendChild(cardDiv);
            }
            
            // ìˆœì°¨ì ìœ¼ë¡œ ì¹´ë“œ ë‚˜íƒ€ë‚´ê¸°
            const cards = cardsContainer.querySelectorAll('.generating-card');
            let delay = 0;
            
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('appear');
                    
                    // ë§ˆì§€ë§‰ ì¹´ë“œ ì™„ë£Œ í›„ ì²˜ë¦¬
                    if (index === cards.length - 1) {
                        setTimeout(() => {
                            finishCardGeneration();
                        }, 1000);
                    }
                }, delay);
                delay += 100;
            });
        }

        function finishCardGeneration() {
            // 24ì‹œê°„ ì¹´ë“œ ìƒì„±
            generateTodayCards();
            
            // ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById('cards-generating').classList.remove('active');
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('draw-cards-section').style.display = 'none';
            document.getElementById('main-card-section').style.display = 'block';
            document.getElementById('memo-section').style.display = 'block';
            document.getElementById('hour-scroll-section').style.display = 'block';
            
            // ë°ì´í„° ì €ì¥
            isCardsDrawn = true;
            saveUserData();
            
            // í˜„ì¬ ì¹´ë“œì™€ ì‹œê°„ ìŠ¤í¬ë¡¤ ì—…ë°ì´íŠ¸
            updateMainCard();
            generateHourScroll();
            
            // ì„±ê³µ í† ìŠ¤íŠ¸
            showToast('âœ¨ 24ì‹œê°„ íƒ€ë¡œ ì¹´ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        function generateTodayCards() {
            const today = new Date().toDateString();
            todayCards[today] = {};
            
            // ê° ì‹œê°„ëŒ€ë³„ë¡œ ëœë¤ ì¹´ë“œ í• ë‹¹
            for (let hour = 0; hour < 24; hour++) {
                const randomIndex = Math.floor(Math.random() * tarotCards.length);
                const card = { ...tarotCards[randomIndex] };
                card.reversed = Math.random() < 0.3; // 30% í™•ë¥ ë¡œ ì—­ë°©í–¥
                todayCards[today][hour] = card;
            }
        }

        function updateMainCard() {
            const today = new Date().toDateString();
            const currentCard = todayCards[today]?.[currentHour];
            
            if (!currentCard) return;
            
            // ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            const timeText = formatHourText(currentHour);
            document.getElementById('main-card-time').textContent = `í˜„ì¬ ${timeText} ì¹´ë“œ`;
            
            // ì¹´ë“œëª… ì—…ë°ì´íŠ¸
            document.getElementById('main-card-name').textContent = currentCard.name;
            
            // ì¹´ë“œ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            const mainCardElement = document.getElementById('main-tarot-card');
            updateCardVisual(mainCardElement, currentCard);
            
            // í˜„ì¬ ì‹œê°„ í•˜ì´ë¼ì´íŠ¸
            mainCardElement.classList.add('current-hour');
            
            // ë©”ëª¨ ë¡œë“œ
            loadCurrentMemo();
        }

        function updateCardVisual(cardElement, card) {
            cardElement.innerHTML = `
                <div class="tarot-card-front ${card.reversed ? 'reversed' : ''}">
                    <div class="card-number">${card.number}</div>
                    <div class="card-image">${card.emoji}</div>
                    <div class="card-name">${card.name}</div>
                </div>
            `;
            
            if (card.reversed) {
                cardElement.classList.add('reversed');
            } else {
                cardElement.classList.remove('reversed');
            }
        }

        function generateHourScroll() {
            const scrollContainer = document.getElementById('hour-scroll-section');
            const today = new Date().toDateString();
            
            let html = '';
            for (let hour = 0; hour < 24; hour++) {
                const card = todayCards[today]?.[hour];
                const timeText = formatHourText(hour, true);
                const isCurrentHour = hour === currentHour;
                const hasMemo = memos[`${today}-${hour}`]?.trim() !== '';
                
                html += `
                    <div class="hour-card ${isCurrentHour ? 'current' : ''}" data-hour="${hour}">
                        <div class="tarot-card ${isCurrentHour ? 'current-hour' : ''} ${hasMemo ? 'has-memo' : ''}" 
                             onclick="openCardDetail(${hour})">
                            ${card ? `
                                <div class="tarot-card-front ${card.reversed ? 'reversed' : ''}">
                                    <div style="font-size: 20px;">${card.emoji}</div>
                                </div>
                            ` : '<div class="tarot-card-back">ğŸ”®</div>'}
                        </div>
                        <div class="hour-time">${timeText}</div>
                    </div>
                `;
            }
            
            scrollContainer.innerHTML = html;
            
            // í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                const currentCard = scrollContainer.querySelector('.hour-card.current');
                if (currentCard) {
                    currentCard.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                }
            }, 100);
        }

        function updateHourHighlight() {
            // ì‹œê°„ ìŠ¤í¬ë¡¤ì˜ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.hour-card').forEach((card, index) => {
                if (index === currentHour) {
                    card.classList.add('current');
                    card.querySelector('.tarot-card').classList.add('current-hour');
                } else {
                    card.classList.remove('current');
                    card.querySelector('.tarot-card').classList.remove('current-hour');
                }
            });
        }

        function openCardDetail(hour) {
            const today = new Date().toDateString();
            const card = todayCards[today]?.[hour];
            
            if (!card) return;
            
            const modal = document.getElementById('card-detail-modal');
            const modalCard = document.getElementById('modal-tarot-card');
            const modalTime = document.getElementById('modal-card-time');
            const modalName = document.getElementById('modal-card-name');
            const modalMemo = document.getElementById('modal-memo');
            
            // ëª¨ë‹¬ ë‚´ìš© ì—…ë°ì´íŠ¸
            modalTime.textContent = formatHourText(hour);
            modalName.textContent = card.name;
            updateCardVisual(modalCard, card);
            
            // ë©”ëª¨ ë¡œë“œ
            const memoKey = `${today}-${hour}`;
            modalMemo.value = memos[memoKey] || '';
            
            // í˜„ì¬ ì‹œê°„ ì €ì¥ (ë„¤ë¹„ê²Œì´ì…˜ìš©)
            modal.dataset.currentHour = hour;
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.classList.add('active');
        }

        function closeModal() {
            const modal = document.getElementById('card-detail-modal');
            const modalMemo = document.getElementById('modal-memo');
            const hour = parseInt(modal.dataset.currentHour);
            
            // ë©”ëª¨ ì €ì¥
            if (modalMemo.value.trim()) {
                const today = new Date().toDateString();
                const memoKey = `${today}-${hour}`;
                memos[memoKey] = modalMemo.value;
                saveUserData();
                
                // ë©”ëª¨ dot ì—…ë°ì´íŠ¸
                updateMemoDots();
            }
            
            modal.classList.remove('active');
        }

        function navigateHour(direction) {
            const modal = document.getElementById('card-detail-modal');
            let hour = parseInt(modal.dataset.currentHour);
            
            hour += direction;
            if (hour < 0) hour = 23;
            if (hour > 23) hour = 0;
            
            closeModal();
            setTimeout(() => openCardDetail(hour), 100);
        }

        function loadCurrentMemo() {
            const today = new Date().toDateString();
            const memoKey = `${today}-${currentHour}`;
            const currentMemoElement = document.getElementById('current-memo');
            
            currentMemoElement.value = memos[memoKey] || '';
        }

        function saveMemo() {
            const today = new Date().toDateString();
            const memoKey = `${today}-${currentHour}`;
            const memoText = document.getElementById('current-memo').value;
            
            memos[memoKey] = memoText;
            saveUserData();
            updateMemoDots();
            
            showToast('âœ… ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        function autoSaveMemo() {
            const today = new Date().toDateString();
            const memoKey = `${today}-${currentHour}`;
            const memoText = document.getElementById('current-memo').value;
            
            if (memoText.trim()) {
                memos[memoKey] = memoText;
                saveUserData();
                updateMemoDots();
            }
        }

        function updateMemoDots() {
            const today = new Date().toDateString();
            
            document.querySelectorAll('.hour-card .tarot-card').forEach((card, hour) => {
                const memoKey = `${today}-${hour}`;
                const hasMemo = memos[memoKey]?.trim() !== '';
                
                if (hasMemo) {
                    card.classList.add('has-memo');
                } else {
                    card.classList.remove('has-memo');
                }
            });
        }

        function formatHourText(hour, short = false) {
            if (short) {
                return hour === 0 ? '00' : hour.toString().padStart(2, '0');
            }
            
            if (hour === 0) return 'ìì •';
            if (hour === 12) return 'ì •ì˜¤';
            if (hour < 12) return `ì˜¤ì „ ${hour}ì‹œ`;
            return `ì˜¤í›„ ${hour - 12}ì‹œ`;
        }

        function loadUserData() {
            try {
                const savedData = localStorage.getItem('tarot24h-data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    todayCards = data.todayCards || {};
                    memos = data.memos || {};
                    isCardsDrawn = data.isCardsDrawn || false;
                    
                    // ì˜¤ëŠ˜ ì¹´ë“œê°€ ë½‘í˜”ëŠ”ì§€ í™•ì¸
                    const today = new Date().toDateString();
                    if (isCardsDrawn && todayCards[today]) {
                        // UI ì—…ë°ì´íŠ¸
                        document.getElementById('draw-cards-section').style.display = 'none';
                        document.getElementById('main-card-section').style.display = 'block';
                        document.getElementById('memo-section').style.display = 'block';
                        document.getElementById('hour-scroll-section').style.display = 'block';
                        
                        updateMainCard();
                        generateHourScroll();
                        updateMemoDots();
                    }
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        function saveUserData() {
            try {
                const data = {
                    todayCards,
                    memos,
                    isCardsDrawn,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('tarot24h-data', JSON.stringify(data));
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ìŠ¤í”„ë ˆë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function selectSpread(card) {
            const spreadType = card.dataset.spread;
            const cardCount = parseInt(card.dataset.count);
            
            currentSpread = {
                type: spreadType,
                name: card.querySelector('.spread-name').textContent,
                count: cardCount,
                cards: {}
            };
            
            spreadProgress = 0;
            currentSpreadCards = {};
            
            // ìŠ¤í”„ë ˆë“œ í™”ë©´ìœ¼ë¡œ ì „í™˜
            document.getElementById('spread-selection-screen').style.display = 'none';
            document.getElementById('active-spread-screen').style.display = 'block';
            
            // í—¤ë” ì—…ë°ì´íŠ¸
            document.getElementById('current-spread-name').textContent = currentSpread.name;
            updateSpreadProgress();
            
            // ìŠ¤í”„ë ˆë“œ ë ˆì´ì•„ì›ƒ ìƒì„±
            generateSpreadLayout(spreadType, cardCount);
        }

        function generateSpreadLayout(spreadType, cardCount) {
            const canvas = document.getElementById('spread-canvas');
            canvas.innerHTML = '';
            
            const layout = document.createElement('div');
            layout.className = `spread-layout ${spreadType}`;
            
            // ìŠ¤í”„ë ˆë“œë³„ ë¼ë²¨
            const labels = getSpreadLabels(spreadType);
            
            for (let i = 0; i < cardCount; i++) {
                const slot = document.createElement('div');
                slot.className = 'card-slot';
                slot.dataset.slotIndex = i;
                
                const label = document.createElement('div');
                label.className = 'slot-label';
                label.textContent = labels[i] || `ì¹´ë“œ ${i + 1}`;
                slot.appendChild(label);
                
                slot.addEventListener('click', () => drawSpreadCard(i));
                layout.appendChild(slot);
            }
            
            canvas.appendChild(layout);
        }

        function getSpreadLabels(spreadType) {
            const labels = {
                'celtic-cross': ['í˜„ì¬', 'ë„ì „/ê¸°íšŒ', 'ë¨¼ ê³¼ê±°', 'ê°€ëŠ¥í•œ ë¯¸ë˜', 'ìµœê·¼ ê³¼ê±°', 'ê°€ê¹Œìš´ ë¯¸ë˜', 'ìì‹ ', 'ì™¸ë¶€ ì˜í–¥', 'í¬ë§ê³¼ ë‘ë ¤ì›€', 'ìµœì¢… ê²°ê³¼'],
                'cup-relationship': ['ë‚˜', 'ìƒëŒ€ë°©', 'ê´€ê³„', 'ê³¼ê±°', 'í˜„ì¬', 'ë¯¸ë˜', 'ì¡°ì–¸'],
                'five-card': ['ì¤‘ì‹¬', 'ë™ìª½', 'ë‚¨ìª½', 'ì„œìª½', 'ë¶ìª½'],
                'four-timeline': ['ê³¼ê±°', 'í˜„ì¬', 'ë¯¸ë˜', 'ì¡°ì–¸'],
                'three-card': ['ê³¼ê±°', 'í˜„ì¬', 'ë¯¸ë˜'],
                'one-card': ['ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€']
            };
            return labels[spreadType] || [];
        }

        function drawSpreadCard(slotIndex) {
            if (currentSpreadCards[slotIndex]) return; // ì´ë¯¸ ë½‘íŒ ì¹´ë“œ
            
            // ì¹´ë“œ ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜
            showDrawCardModal(() => {
                const randomIndex = Math.floor(Math.random() * tarotCards.length);
                const card = { ...tarotCards[randomIndex] };
                card.reversed = Math.random() < 0.3; // 30% í™•ë¥ ë¡œ ì—­ë°©í–¥
                
                // ì´ë¯¸ ë½‘íŒ ì¹´ë“œëŠ” ì œì™¸ (ì¤‘ë³µ ë°©ì§€)
                const usedCards = Object.values(currentSpreadCards).map(c => c.name);
                if (usedCards.includes(card.name)) {
                    // ë‹¤ë¥¸ ì¹´ë“œ ì„ íƒ
                    let attempts = 0;
                    while (usedCards.includes(card.name) && attempts < 50) {
                        const newIndex = Math.floor(Math.random() * tarotCards.length);
                        Object.assign(card, tarotCards[newIndex]);
                        card.reversed = Math.random() < 0.3;
                        attempts++;
                    }
                }
                
                currentSpreadCards[slotIndex] = card;
                updateSpreadSlot(slotIndex, card);
                spreadProgress++;
                updateSpreadProgress();
                
                // ëª¨ë“  ì¹´ë“œ ì™„ì„± ì‹œ
                if (spreadProgress >= currentSpread.count) {
                    document.getElementById('capture-spread').disabled = false;
                    showToast('âœ¨ ìŠ¤í”„ë ˆë“œê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }
            });
        }

        function showDrawCardModal(onComplete) {
            const modal = document.getElementById('draw-card-modal');
            const cardElement = document.getElementById('drawing-tarot-card');
            
            modal.classList.add('active');
            cardElement.innerHTML = '<div class="tarot-card-back">ğŸ”®</div>';
            cardElement.classList.add('card-flip');
            
            setTimeout(() => {
                modal.classList.remove('active');
                cardElement.classList.remove('card-flip');
                if (onComplete) onComplete();
            }, 1500);
        }

        function updateSpreadSlot(slotIndex, card) {
            const slot = document.querySelector(`[data-slot-index="${slotIndex}"]`);
            if (!slot) return;
            
            slot.innerHTML = '';
            slot.classList.add('filled');
            
            const cardElement = document.createElement('div');
            cardElement.className = `tarot-card ${card.reversed ? 'reversed' : ''}`;
            updateCardVisual(cardElement, card);
            
            // ë¡±í„°ì¹˜ë¡œ ì¹´ë“œ ë’¤ì§‘ê¸°
            let longTouchTimer;
            cardElement.addEventListener('touchstart', (e) => {
                longTouchTimer = setTimeout(() => {
                    card.reversed = !card.reversed;
                    cardElement.classList.toggle('reversed');
                    updateCardVisual(cardElement, card);
                    showToast(card.reversed ? 'ğŸ”„ ì—­ë°©í–¥ìœ¼ë¡œ ë³€ê²½' : 'ğŸ”„ ì •ë°©í–¥ìœ¼ë¡œ ë³€ê²½');
                }, 800);
            });
            
            cardElement.addEventListener('touchend', () => {
                clearTimeout(longTouchTimer);
            });
            
            slot.appendChild(cardElement);
        }

        function updateSpreadProgress() {
            if (!currentSpread) return;
            document.getElementById('spread-progress').textContent = 
                `${spreadProgress}/${currentSpread.count}`;
        }

        function backToSpreadSelection() {
            if (spreadProgress > 0) {
                if (!confirm('ì§„í–‰ ì¤‘ì¸ ìŠ¤í”„ë ˆë“œê°€ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }
            
            document.getElementById('active-spread-screen').style.display = 'none';
            document.getElementById('spread-selection-screen').style.display = 'block';
            
            // ìƒíƒœ ì´ˆê¸°í™”
            currentSpread = null;
            currentSpreadCards = {};
            spreadProgress = 0;
        }

        function resetCurrentSpread() {
            if (!confirm('ìŠ¤í”„ë ˆë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            currentSpreadCards = {};
            spreadProgress = 0;
            updateSpreadProgress();
            document.getElementById('capture-spread').disabled = true;
            
            // ìŠ¬ë¡¯ë“¤ ì´ˆê¸°í™”
            document.querySelectorAll('.card-slot').forEach((slot, index) => {
                slot.classList.remove('filled');
                const labels = getSpreadLabels(currentSpread.type);
                slot.innerHTML = `<div class="slot-label">${labels[index] || `ì¹´ë“œ ${index + 1}`}</div>`;
            });
            
            showToast('ğŸ”„ ìŠ¤í”„ë ˆë“œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function captureSpread() {
            if (spreadProgress < currentSpread.count) {
                showToast('âš ï¸ ëª¨ë“  ì¹´ë“œë¥¼ ë½‘ì•„ì£¼ì„¸ìš”');
                return;
            }
            
            // ê°„ë‹¨í•œ ìº¡ì²˜ ì‹œë®¬ë ˆì´ì…˜
            showToast('ğŸ“¸ ìŠ¤í”„ë ˆë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            // ì €ì¥ëœ ìŠ¤í”„ë ˆë“œ ë°ì´í„° ìƒì„±
            const savedSpread = {
                id: Date.now(),
                type: currentSpread.type,
                name: currentSpread.name,
                cards: { ...currentSpreadCards },
                createdAt: new Date().toISOString()
            };
            
            // localStorageì— ì €ì¥
            saveSpreadData(savedSpread);
            
            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì¼ê¸° íƒ­ìœ¼ë¡œ ì´ë™
            setTimeout(() => {
                document.querySelector('[data-tab="diary"]').click();
                showToast('ğŸ“š ì¼ê¸° íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”');
            }, 2000);
        }

        function saveSpreadData(spreadData) {
            try {
                const savedSpreads = JSON.parse(localStorage.getItem('saved-spreads') || '[]');
                savedSpreads.unshift(spreadData);
                
                // ìµœëŒ€ 20ê°œë§Œ ë³´ê´€
                if (savedSpreads.length > 20) {
                    savedSpreads.splice(20);
                }
                
                localStorage.setItem('saved-spreads', JSON.stringify(savedSpreads));
            } catch (error) {
                console.error('ìŠ¤í”„ë ˆë“œ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ì•± ìƒëª…ì£¼ê¸° ê´€ë¦¬
        window.addEventListener('beforeunload', function() {
            saveUserData();
        });

        // ê°€ì‹œì„± ë³€ê²½ ì‹œ ì €ì¥
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                saveUserData();
            }
        });

        // í„°ì¹˜ ìµœì í™”
        document.addEventListener('touchstart', function() {}, { passive: true });
        
        // ì¤Œ ë°©ì§€
        document.addEventListener('touchmove', function(e) {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>